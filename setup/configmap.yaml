apiVersion: v1
kind: ConfigMap
metadata:
  name: installation-configmap
data:
  kube-prom-stack.values.yaml: |-
    # Configure Kube prom stack values here
    alertmanager:
      enabled: false
    grafana:
      enabled: false

  keda.values.yaml: |-
    # Configure Keda values here
  
  nginx.values.yaml: |-
    # Configure nginx values here
    controller:
      metrics:
        enabled: true
        service:
          annotations:
            prometheus.io/port: "10254"
            prometheus.io/scrape: "true"
      podAnnotations:
        prometheus.io/port: "10254"
        prometheus.io/scrape: "true"
    
  cert-manager.values.yaml: |-
    # Configure cert-manager values here
    crds:
      enabled: true

  install.sh: |-
    #!/bin/bash
    
    # Install dependencies
    apt-get update && apt-get install -y curl
    
    # Install Kubectl
    curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl
    chmod +x ./kubectl
    mv ./kubectl /usr/local/bin

    # Testing cluster connection
    kubectl get ns

    # Install helm
    curl -LO https://get.helm.sh/helm-v3.7.0-linux-amd64.tar.gz
    tar -zxvf helm-v3.7.0-linux-amd64.tar.gz
    mv linux-amd64/helm /usr/local/bin/helm

    # Helm release keda
    helm repo add kedacore https://kedacore.github.io/charts
    helm repo update
    helm install keda kedacore/keda --namespace keda --create-namespace -f /tmp/jobs/keda.values.yaml

    # Helm release nginx
    helm repo add nginx oci://ghcr.io/nginxinc/charts
    helm repo update
    helm install nginx nginx/nginx-ingress --namespace nginx --create-namespace -f /tmp/jobs/nginx.values.yaml

    # Helm release cert-manager
    helm repo add jetstack https://charts.jetstack.io
    helm repo update
    helm install cert-manager jetstack/cert-manager --namespace cert-manager --create-namespace -f /tmp/jobs/cert-manager.values.yaml

    # Helm release Kube prom stack
    helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
    helm repo update
    helm install prometheus prometheus-community/kube-prometheus-stack --namespace prometheus -f /tmp/jobs/kube-prom-stack.values.yaml


    
